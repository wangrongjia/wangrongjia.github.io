---
link: https://www.v2ex.com/t/1103045
site: V2EX
date: 2025-01-07T05:30
excerpt: 程序员 - @289396212 - 把这些中间实体单独作为一个 aggregate 吗？
twitter: https://twitter.com/@V2EX
slurped: 2025-02-06T09:12
title: 正在用 DDD 开发，请问在划分 aggregate 时候，遇到一些多对多的中间表该怎么处理？ - V2EX
---


把这些中间实体单独作为一个 aggregate 吗？

|                                                                                  |     |                                                                                                                                                                                          |
| -------------------------------------------------------------------------------- | --- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![dcdlove](https://cdn.v2ex.com/avatar/773e/220b/264957_normal.png?m=1716878792) |     | 1<br><br>**[dcdlove](https://www.v2ex.com/member/dcdlove)**      30 天前<br><br>通过领域事件来协调多对多关系的更新。例如，当一个 Student 注册到一个 Course 时，可以发布一个 StudentRegisteredForCourse 事件，其他聚合可以订阅这个事件并更新自己的状态。 |

|   |   |   |
|---|---|---|
|![289396212](https://cdn.v2ex.com/gravatar/9102c9a79751e53a01fb4f460c0d8bc1?s=48&d=retro)||2<br><br>**[289396212](https://www.v2ex.com/member/289396212)**      30 天前<br><br>@[dcdlove](https://www.v2ex.com/member/dcdlove) 所以中间表还是存在的吗？只是原本是直接拿到这个中间实体的 repo 来增加一个 Student 和 Course 的 row, 变成了从领域事件里来增加这个 Student 和 Course 的 row ？|

|   |   |   |
|---|---|---|
|![alcoholpad](https://cdn.v2ex.com/avatar/5280/fc5b/402001_normal.png?m=1565273239)||3<br><br>**[alcoholpad](https://www.v2ex.com/member/alcoholpad)**      29 天前   ![❤️](https://www.v2ex.com/static/img/heart_neue_red.png?v=16ec2dd0a880be6edda1e4a2e35754b3) 1<br><br>“把这些中间实体单独作为一个 aggregate 吗？”  <br>这个要根据实际业务情况来分析的，如果这个中间实体没有独立的业务场景，只是关联关系的话，不需要单独作为聚合根。 但如果它有独立的业务场景和生命周期，就需要单独作为一个聚合根，比如说学生和课程这个 “选课” 中间关系，选课需要审批流程（独立业务场景）、选课要求不随着学生或课程的不存在而消失（独立的生命周期）等。|

|                                                                                          |     |                                                                                                                                                                                                                                                                                                                           |
| ---------------------------------------------------------------------------------------- | --- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![YuuuuuuH](https://cdn.v2ex.com/gravatar/aa031d11c3cb9e32c9d1227868e836bc?s=48&d=retro) |     | 5<br><br>**[YuuuuuuH](https://www.v2ex.com/member/YuuuuuuH)**      29 天前   ![❤️](https://www.v2ex.com/static/img/heart_neue_red.png?v=16ec2dd0a880be6edda1e4a2e35754b3) 1<br><br>**多对多里面一定有业务，你得提取它的业务概念出来。比如 Student 和 Course 的多对多关系，可以提取出 [选课] （ CourseEnrollment ）的业务概念。DDD 一定要提取业务概念！ DDD 一定要提取业务概念！ DDD 一定要提取业务概念！** |

|                                                                                |     |                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ------------------------------------------------------------------------------ | --- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| ![AcFnu](https://cdn.v2ex.com/avatar/a471/10f9/678879_normal.png?m=1709630891) |     | 6<br><br>**[AcFnu](https://www.v2ex.com/member/AcFnu)**      29 天前   ![❤️](https://www.v2ex.com/static/img/heart_neue_red.png?v=16ec2dd0a880be6edda1e4a2e35754b3) 2<br><br>领域设计就不要表设计先行了，分析问题的时候只关心领域业务，先把你问题域分析好了，就拿上面学生和课程的例子来说，学生和课程理论上都要单独作为聚合根的，此时学生与课程的关联关系是要单独处一个 Vec<Student>和 Vec<Course>的业务聚合根（或者更多你的业务）用来处理学生和课程多对多的领域问题，然后正常就走 route-》 cmd-》 handler-》 aggregate-》 event-》至于监听事件后的 repo 你关系行数据库就正常该怎么关联存就怎么存 |

|   |   |   |
|---|---|---|
|![WispZhan](https://cdn.v2ex.com/gravatar/ba29e4684a2d7100d30fa23f3ac10ee5?s=48&d=retro)||7<br><br>**[WispZhan](https://www.v2ex.com/member/WispZhan)**      29 天前<br><br>@[AcFnu](https://www.v2ex.com/member/AcFnu) +1<br><br>业务层是业务层，持久层是持久层。 既然是 DDD ，就不要搞普通的三层了。嫌多、嫌麻烦就不用 DDD 。|