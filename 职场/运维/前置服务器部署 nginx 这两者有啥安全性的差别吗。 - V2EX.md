---
link: https://www.v2ex.com/t/1109549
site: V2EX
date: 2025-02-07T11:12
excerpt: 程序员 - @Renco - 标题内容可以有点绕。大致意思就是，客户需要内网部署的 web
  服务能在互联网访问到。首先提出方案，加一台前置机在互联网上，并可以访问到内网服务器。然后在上面部署 nginx ，通过端口 ngi
twitter: https://twitter.com/@V2EX
slurped: 2025-02-07T14:50
title: 前置服务器部署 nginx
  用来转发到内网对应的服务上，和在前置服务器部署服务，然后将数据库相关部署内网服务器上，通过修改前置服务器部署的数据库连接访问数据。这两者有啥安全性的差别吗。
  - V2EX
---

标题内容可以有点绕。

大致意思就是，客户需要内网部署的 web 服务能在互联网访问到。首先提出方案，加一台前置机在互联网上，并可以访问到内网服务器。然后在上面部署 nginx ，通过端口 nginx 代理转发到内网服务器上。来实现外网访问。（之前类似需求，就是按照这套逻辑去实现的。）

后来有客户不同意这种穿透模式，不让用 nginx ，说要么就是你们内网部署一套 web 服务，外网也部署一套相同的 web 服务，然后数据信息全部在内网服务器上。外网那边修改数据库访问的链接，外网到内网的端口由客户那边来打通。

想了解下，为啥 nginx 那套不让用，客户说是安全性问题但是不是太理解，nginx 转发端口，一个是 nginx 内配置，同时客户那边也要打通端口才能转发到内网。第二套方案，不用 nginx 但是同样需要客户打通端口到内网。

基于此情况，我们还有一个文件中心，文件中心由于是直接用的现成的对象存储方案，文件是 url 形式返回的。如果外网的 web 服务访问内网文件中心，那还是可能要通过 nginx 等代理方式实现转发。因此不是太理解两者区别。

[](https://www.v2ex.com/tag/Nginx)

[Nginx](https://www.v2ex.com/tag/Nginx)[

安全](https://www.v2ex.com/tag/%E5%AE%89%E5%85%A8)[

端口](https://www.v2ex.com/tag/%E7%AB%AF%E5%8F%A3)

10 条回复  **•**  2025-02-07 14:40:41 +08:00

|   |   |   |
|---|---|---|
|![Kinnice](https://cdn.v2ex.com/avatar/4cee/b9bb/189378_normal.png?m=1685439436)||2<br><br>**[Kinnice](https://www.v2ex.com/member/Kinnice)**      3 小时 20 分钟前   ![❤️](https://www.v2ex.com/static/img/heart_neue_red.png?v=16ec2dd0a880be6edda1e4a2e35754b3) 1<br><br>猜测，数据库连接的审计可能更简单些，毕竟数据库如果把一些特性关闭很难通过数据库连接拿 shell ，但是 web 服务器就相较于简单一些。|

|   |   |   |
|---|---|---|
|![Kinnice](https://cdn.v2ex.com/avatar/4cee/b9bb/189378_normal.png?m=1685439436)||3<br><br>**[Kinnice](https://www.v2ex.com/member/Kinnice)**      3 小时 19 分钟前   ![❤️](https://www.v2ex.com/static/img/heart_neue_red.png?v=16ec2dd0a880be6edda1e4a2e35754b3) 1<br><br>nginx ==> waf 可能客户会比较好接受，比如雷池 waf 社区版|

|   |   |   |
|---|---|---|
|![ipwx](https://cdn.v2ex.com/avatar/74e7/b1ce/86855_normal.png?m=1544848422)||4<br><br>**[ipwx](https://www.v2ex.com/member/ipwx)**      3 小时 18 分钟前   ![❤️](https://www.v2ex.com/static/img/heart_neue_red.png?v=16ec2dd0a880be6edda1e4a2e35754b3) 1<br><br>因为客户需要审计各个组件的安全性（包括有没有人去按时补漏洞）吧。<br><br>nginx 你不做，客户没人做，所以不让用。|

|   |   |   |
|---|---|---|
|![ipwx](https://cdn.v2ex.com/avatar/74e7/b1ce/86855_normal.png?m=1544848422)||5<br><br>**[ipwx](https://www.v2ex.com/member/ipwx)**      3 小时 18 分钟前   ![❤️](https://www.v2ex.com/static/img/heart_neue_red.png?v=16ec2dd0a880be6edda1e4a2e35754b3) 1<br><br>换句话说，你做的 web 服务出问题了客户可以找你修。nginx 出问题了他是不是没人找了。|

|   |   |   |
|---|---|---|
|![Renco](https://cdn.v2ex.com/avatar/8530/7718/402540_normal.png?m=1733886067)||6<br><br>**[Renco](https://www.v2ex.com/member/Renco)**      1 小时 43 分钟前<br><br>好吧，谢谢解答|

|   |   |   |
|---|---|---|
|![Yanlongli](https://cdn.v2ex.com/avatar/e284/9e62/466417_normal.png?m=1735622028)||7<br><br>**[Yanlongli](https://www.v2ex.com/member/Yanlongli)**      1 小时 25 分钟前<br><br>理想状态两者无区别。<br><br>安全性前者好一些，前面的转发服务器可以套防火墙之类的防止攻击，后面服务器负责 web+数据库两个服务  <br>性能后者好一些，相当于一台服务器只做 WEB 服务，一台服务器只做数据库服务，任务分开。|

|                                                                                     |     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ----------------------------------------------------------------------------------- | --- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![qwx](https://cdn.v2ex.com/gravatar/9439900c180a881e28bd43d5eddfd2ee?s=48&d=retro) |     | 8<br><br>**[qwx](https://www.v2ex.com/member/qwx)**      1 小时 12 分钟前   ![❤️](https://www.v2ex.com/static/img/heart_neue_red.png?v=16ec2dd0a880be6edda1e4a2e35754b3) 1<br><br>**内外网分区分域，我们就要严格要求，无需与互联网产生关系的服务器（数据库）必须放内网，其他都放在 dmz 区，nginx 是完整转发请求，如果 web 服务器被攻击了，直接会导致使用内网服务器做跳板横向迁移，但如果 web 服务器在 dmz 区，横向跳转的风险不大。**                                                                                                                                                                                                                  |
|                                                                                     |     | DMZ区（Demilitarized Zone，隔离区或非军事化区）是一个特殊的网络区域，通常位于内部私有网络和外部公共网络（如互联网）之间的防火墙中或防火墙之后。它的设计目的是为了增加一个额外的安全层，以保护内部网络免受外部攻击。<br>以下是DMZ区的一些关键点：<br>安全缓冲：DMZ作为一个缓冲区，将对外提供服务的服务器（如Web服务器、邮件服务器等）与内部网络隔离开来，即使这些服务器被攻破，攻击者也难以直接访问到内网中的敏感信息。<br>服务暴露：企业可以将需要公开访问的服务放置在DMZ中，比如HTTP、HTTPS、FTP、SMTP等服务，使得外部用户可以在不直接接触内部网络的情况下使用这些服务。<br>多层防护：一般情况下，会使用两个防火墙来创建DMZ，一个在外侧（面向互联网），另一个在内侧（面向内部网络）。外侧防火墙控制外界对DMZ的访问，而内侧防火墙则保护内部网络不受来自DMZ的威胁。<br>最小权限原则：部署在DMZ中的服务器应该遵循最小权限原则配置，即只开放必要的端口和服务，并且严格限制从DMZ到内部网络的通信。<br>因此，DMZ是信息安全策略中的一个重要组成部分，有助于提高组织的整体网络安全水平。 |

|   |   |   |
|---|---|---|
|![Renco](https://cdn.v2ex.com/avatar/8530/7718/402540_normal.png?m=1733886067)||9<br><br>**[Renco](https://www.v2ex.com/member/Renco)**      1 小时 7 分钟前<br><br>@[qwx](https://www.v2ex.com/member/qwx) #8 懂了，谢谢！我们客户有提到过这个 dmz 区，一开始没太了解这个概念，客户的要求就是 web 服务部署在 dmz 区，数据入内网。经过你解释后清楚了。|

|   |   |   |
|---|---|---|
|![qfdk](https://cdn.v2ex.com/avatar/3680/4f41/64426_normal.png?m=1718350658)||10<br><br>**[qfdk](https://www.v2ex.com/member/qfdk)**      7 分钟前 via iPhone<br><br>简单来说. 你家有一个公网 ip 你接了个路由器. nginx 机器 192.168.1.100 可以 dmz. 等于这台机器在公网. 所有请求都会来.100. 理论上 nginx 只有 web 服务. 这样扫描就只有 web 服务. 数据库可以放在 192.168.1.200 ， 业务机器可以 192.168.1.250 ，nginx 负责给请求转发给 1.250. 理论上 三台机器内网互通 外网之后 nginx 的可以通|